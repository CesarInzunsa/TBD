/**
PRACTICA 7
AUTOR: INZUNSA DIAZ CESAR ALEJANDRO
NO. CONTROL: 19400595
FECHA: 19/10/2021
DESCRIPCION: REFORZAR EL USO DE INNER JOIN, INSERCION DE REGISTROS, UPDATE, Y CREACIÓN DE VISTAS
**/
--PONER EN USO LA BD
USE CAMPEONATO_DE_AJEDREZ;

--INSERTAR REGISTROS EN TIPO DE CONCURSO
INSERT INTO TIPO_CONCURSO VALUES
('PRINCIPIANTE',1),
('INTERMEDIO',2),
('BASICO',1),
('AVANZADO',3),
('MASTER',4),
('EXPERTO',4);

--INSERTAR REGISTROS EN CARRERAS
INSERT INTO CARRERAS VALUES
('ISC','ING. EN SISTEMAS COMPUTACIONALES','2025-01-01'),
('IGE','ING. EN GESTION EMPRESARIAL','2024-01-01'),
('II','ING. INDUSTRIAL','2025-01-01'),
('LA','LICENCIATURA EN ADMINISTRACION','2025-01-01'),
('IQ','ING. QUIMICA','2025-01-01'),
('IBQ','ING. BIOQUIMICA','2025-01-01'),
('ARQ','ARQUITECTURA','2025-01-01'),
('ITICS','ING. EN TEC. INF. Y COMUNICACION','2025-01-01'),
('IC','INGENIERIA CIVIL','2025-01-01'),
('IM','ING. EN MECATRONICA','2025-01-01'),
('IE','ING. ELECTRICA','2025-01-01');


--INSERTAR DE FORMA MASIVA REGISTROS EN PARTICIPANTES
BULK INSERT PARTICIPANTES FROM 'C:\TBD2021\U2\PARTICIPANTES.CSV' WITH (FIELDTERMINATOR = ',');

--Inserta los resultados de todos los tipos de concurso. Insertando primero, segundo y
--tercer lugar para cada uno.
INSERT INTO RESULTADOS VALUES
(1,17401036,1,1,'SIN OBSERVACIONES',15),
(2,18401079,2,2,'SIN OBSERVACIONES',10),
(3,18401093,3,3,'SIN OBSERVACIONES',5),
(4,18401136,4,1,'SIN OBSERVACIONES',15),
(5,18401147,5,2,'SIN OBSERVACIONES',10),
(6,18401155,6,3,'SIN OBSERVACIONES',5),

(7,18401157,1,1,'SIN OBSERVACIONES',15),
(8,18401162,2,2,'SIN OBSERVACIONES',10),
(9,18401169,3,3,'SIN OBSERVACIONES',5),
(10,18401174,4,1,'SIN OBSERVACIONES',15),
(11,18401196,5,2,'SIN OBSERVACIONES',10),
(12,18401197,6,3,'SIN OBSERVACIONES',5),

(13,18401215,1,1,'SIN OBSERVACIONES',15),
(14,19400203,2,2,'SIN OBSERVACIONES',10),
(15,19400408,3,3,'SIN OBSERVACIONES',5),
(16,19400526,4,1,'SIN OBSERVACIONES',15),
(17,19400527,5,2,'SIN OBSERVACIONES',10),
(18,19400535,6,3,'SIN OBSERVACIONES',5),

(19,19400539,1,1,'SIN OBSERVACIONES',15),
(20,19400540,2,2,'SIN OBSERVACIONES',10),
(21,19400542,3,3,'SIN OBSERVACIONES',5),
(22,19400543,4,1,'SIN OBSERVACIONES',15),
(23,19400547,5,2,'SIN OBSERVACIONES',10),
(24,19400549,6,3,'SIN OBSERVACIONES',5),

(25,19400553,1,1,'SIN OBSERVACIONES',15),
(26,19400554,2,2,'SIN OBSERVACIONES',10),
(27,19400559,3,3,'SIN OBSERVACIONES',5),
(28,19400560,4,1,'SIN OBSERVACIONES',15),
(29,19400562,5,2,'SIN OBSERVACIONES',10),
(30,19400563,6,3,'SIN OBSERVACIONES',5),

(31,19400564,1,1,'SIN OBSERVACIONES',15),
(32,19400567,2,2,'SIN OBSERVACIONES',10),
(33,19400568,3,3,'SIN OBSERVACIONES',5),
(34,19400570,4,1,'SIN OBSERVACIONES',15),
(35,19400571,5,2,'SIN OBSERVACIONES',10),
(36,19400576,6,3,'SIN OBSERVACIONES',5),

(37,19400579,1,1,'SIN OBSERVACIONES',15),
(38,19400583,2,2,'SIN OBSERVACIONES',10),
(39,19400586,3,3,'SIN OBSERVACIONES',5),
(40,19400588,4,1,'SIN OBSERVACIONES',15),
(41,19400591,5,2,'SIN OBSERVACIONES',10),
(42,19400594,6,3,'SIN OBSERVACIONES',5),

(43,19400595,1,1,'SIN OBSERVACIONES',15),
(44,19400596,2,2,'SIN OBSERVACIONES',10),
(45,19400601,3,3,'SIN OBSERVACIONES',5),
(46,19400603,4,1,'SIN OBSERVACIONES',15),
(47,19400606,5,2,'SIN OBSERVACIONES',10),
(48,19400607,6,3,'SIN OBSERVACIONES',5),

(49,19400608,1,1,'SIN OBSERVACIONES',15),
(50,19400610,2,2,'SIN OBSERVACIONES',10),
(51,19400611,3,3,'SIN OBSERVACIONES',5),
(52,19400613,4,1,'SIN OBSERVACIONES',15),
(53,19400615,5,2,'SIN OBSERVACIONES',10),
(54,19400616,6,3,'SIN OBSERVACIONES',5),

(55,19400617,1,1,'SIN OBSERVACIONES',15),
(56,19400618,2,2,'SIN OBSERVACIONES',10),
(57,19400619,3,3,'SIN OBSERVACIONES',5),
(58,19400621,4,1,'SIN OBSERVACIONES',15),
(59,19400624,5,2,'SIN OBSERVACIONES',10),
(60,19400628,6,3,'SIN OBSERVACIONES',5),

(61,19400629,1,1,'SIN OBSERVACIONES',15),
(62,19400631,2,2,'SIN OBSERVACIONES',10),
(63,19400633,3,3,'SIN OBSERVACIONES',5),
(64,19400636,4,1,'SIN OBSERVACIONES',15),
(65,19400640,5,2,'SIN OBSERVACIONES',10),
(66,19400642,6,3,'SIN OBSERVACIONES',5),

(67,19400645,1,1,'SIN OBSERVACIONES',15),
(68,19400649,2,2,'SIN OBSERVACIONES',10),
(69,19400652,3,3,'SIN OBSERVACIONES',5),
(70,19400653,4,1,'SIN OBSERVACIONES',15),
(71,19400655,5,2,'SIN OBSERVACIONES',10),
(72,19400657,6,3,'SIN- OBSERVACIONES',5),

(73,19400660,1,1,'SIN OBSERVACIONES',15),
(74,19400664,2,2,'SIN OBSERVACIONES',10),
(75,19400668,3,3,'SIN OBSERVACIONES',5),
(76,19400671,4,1,'SIN OBSERVACIONES',15),
(77,19400674,5,2,'SIN OBSERVACIONES',10),
(78,19400675,6,3,'SIN OBSERVACIONES',5),

(79,19400676,1,1,'SIN OBSERVACIONES',15),
(80,19400680,2,2,'SIN OBSERVACIONES',10),
(81,19400684,3,3,'SIN OBSERVACIONES',5),
(82,19400687,4,1,'SIN OBSERVACIONES',15);

/*
6) Actualiza la fecha de nacimiento y semestre de todos los registros, dependiendo 
del año que entraron al tec, más o menos que edad tendrían y ponles a todos los 
de ese semestre y una fecha de nacimiento .
*/

UPDATE PARTICIPANTES SET
SEMESTRE = 9,
[Fecha de Nac] = '1998-01-01'
WHERE [No de Control] LIKE '17%';

UPDATE PARTICIPANTES SET
SEMESTRE = 5,
[Fecha de Nac] = '2000-01-01'
WHERE [No de Control] LIKE '19%';

--07)Actualiza la carrera para queden variadas de acuerdo al no. De terminación del 
--número de controL
UPDATE PARTICIPANTES SET
CARRERA = 'ARQ'
WHERE [No de Control] LIKE '%1';

UPDATE PARTICIPANTES SET
CARRERA = 'IBQ'
WHERE [No de Control] LIKE '%2';

UPDATE PARTICIPANTES SET
CARRERA = 'IC'
WHERE [No de Control] LIKE '%3';

UPDATE PARTICIPANTES SET
CARRERA = 'IE'
WHERE [No de Control] LIKE '%4';

UPDATE PARTICIPANTES SET
CARRERA = 'IGE'
WHERE [No de Control] LIKE '%5';

UPDATE PARTICIPANTES SET
CARRERA = 'II'
WHERE [No de Control] LIKE '%5';

UPDATE PARTICIPANTES SET
CARRERA = 'IM'
WHERE [No de Control] LIKE '%9';

UPDATE PARTICIPANTES SET
CARRERA = 'ISC'
WHERE [No de Control] LIKE '%10';

UPDATE PARTICIPANTES SET
CARRERA = 'ITICS'
WHERE [No de Control] LIKE '%11';

UPDATE PARTICIPANTES SET
CARRERA = 'LA'
WHERE [No de Control] LIKE '%12';

--8) Actualiza tu fecha de nacimiento y pon la correcta.
UPDATE PARTICIPANTES SET
[Fecha de Nac] = '2000-11-03'
WHERE [No de Control] = 19400595;
SELECT * FROM PARTICIPANTES WHERE [No de Control] = 19400595

--9)Muestra a los campeones en cada tipo de concurso, poniendo el tipo de concurso 
--y el nombre del participante, y lugar que lo gano
SELECT  P.[Nombre Completo] AS NOMBRE, TC.TIP_NOMBRE AS [TIPO DE CONCURSO], R.RES_LUGAR AS LUGAR
FROM RESULTADOS R
INNER JOIN PARTICIPANTES P ON(R.NoCtrl = P.[No de Control])
INNER JOIN TIPO_CONCURSO TC ON (TC.TIP_ID = R.tip_id)

--10) Crea una vista el total de alumnos que hay en cada semestre de cada carrera, 
--inscritos en el campeonato de ajedrez
CREATE VIEW V_DATOS_PARTICIPANTES AS (
SELECT CARRERA, SEMESTRE, COUNT(*) AS [total de alumnos]
FROM PARTICIPANTES
GROUP BY CARRERA, SEMESTRE
);

--11) Muestra las lista de alumnos (nombre, no. De control, Semestre y nombre de 
--    carrera, nombre del tipo de concurso) de aquella carrera que tiene más alumnos 
--    inscritos en el campeonato.

--12) Crea una vista el total de alumnos que hay en cada tipo de concurso, con el 
--    nombre del tipo de concurso y el total de alumnos inscritos a él y total de puntos 
--    acumulados de los ganadores
CREATE VIEW V_TOTAL_ALUMNOS_CONCURSOS_PUNTOS AS (
SELECT TP.TIP_NOMBRE, COUNT(P.[No de Control]) AS [NO. ALUMNOS], SUM (R.RES_PUNTOS) AS [PUNTOS ACUMULADOS]
FROM PARTICIPANTES P
INNER JOIN TIPO_CONCURSO TP ON (P.TIPO_CONCURSO = TP.TIP_ID)
INNER JOIN RESULTADOS R ON (P.[No de Control] = R.NoCtrl)
GROUP BY TP.TIP_NOMBRE);


--13) Muestra la lista de alumnos (nombre, no. De control, Semestre y nombre de 
--    carrera) que están inscritos al concurso que tiene más alumnos inscritos.


--14) Borra al tu mejor amigo (o al que te caiga más bien) del grupo de la BD siempre 
--    y cuando no tenga resultados registrados
DELETE FROM PARTICIPANTES
WHERE [No de Control] = '19400603' AND [No de Control] NOT IN (SELECT NoCtrl FROM RESULTADOS)
SELECT * FROM RESULTADOS WHERE NoCtrl = '19400603'